---
title: Simulation in a 3D homogeneous medium using the transient mixed domain method
---
<p>
<br>
<hr>
<hr>
 This example shows how to simulate the wave propagation in a 3D 
 homogeneous medium with the transient mixed domain method. The focused beam is generated with a phased-array.
<hr>
<hr>
</p>

<!---define the structure grid--->
<h6>Generate the grid structure to define the computational domain</h6>
<hr>
<p>
 <br>To define the temporal and spatial computational domain in 3D forward simulations, 
 the funciton <a href="/mSOUND/functions">set_grid</a> is used. For 3D problems,
 eight inputs are required to to call this function. Coordinates generated with the mgrid functiions are all in Cartesian coordinates.
 <br>
 <code>        
<br>dx = 3.75e-04;         <font color="#03a852"> %  step size in the x direction [m]</font> 
<br>dy = 3.75e-04;         <font color="#03a852"> %  step size in the y direction [m]</font> 
<br>dz = 3.75e-04;         <font color="#03a852"> %  step size in the z direction [m]</font> 
<br>dt = 6.25e-08;         <font color="#03a852"> %  time step size [s]</font> 

<br>x_length = 0.0300;         <font color="#03a852"> % total computatoinal domain size in x direction [m]</font> 
<br>y_length = 0.0300;         <font color="#03a852"> % total computatoinal domain size in y direction [m]</font> 
<br>z_length = 0.0150;         <font color="#03a852"> % total computatoinal domain size in z direction [m]</font> 
<br>t_length = 1.60e-05;       <font color="#03a852"> % total temporal domain size [s]</font> 
<br>mgrid = set_grid(dt, t_length, dx, x_length, dy, y_length, dz, z_length);              
</code>   
 <br>
</p>


<!---define a 3D phased array transducer--->
<h6>Define a 3D phased array transducer</h6>
<hr>
<p>
 In this example, phased array transducer is used to generate the foucsed ultrasound beam. 
<code>
<br>
 <br> p0 = 1.0e6;   <font color="#03a852"> %source pressure magnitude [Pa]</font>   
<br>TR_focus  = 0.0120;      <font color="#03a852"> % transducer focus length [m]</font>         
<br>TR_radius = 0.0075;      <font color="#03a852"> % Transducer diameter [m]</font>  
<br>X = ones(mgrid.numy,1)*mgrid.x;
<br>Y = (ones(mgrid.numx,1)*mgrid.y).';
<br>delay = sqrt(X.^2 + Y.^2 + TR_focus^2)/medium.c0; <font color="#03a852"> % calculate the delay for each element [m]</font>   
<br>delay = delay - min(min(delay));
<br> 
</code>
</p>


<!---Excitation signal--->
<h6>Excitation signal</h6>
<hr>
<p>
A four-cycles gaussian-modulated pulse is used as the excitation signal.     
<code>
 <br>
 <br>num_cycles = 4 ;<font color="#03a852"> % number of cycles +/- over which to define the pulse</font>    
<br>ts = [-num_cycles/fc:dt:num_cycles/fc].';<font color="#03a852"> % define the pulse length [s]</font>    
<br>ts = repmat(ts, 1,mgrid.num_x);   
 <br>source_p = zeros(length(ts), mgrid.num_x, mgrid.num_y); <font color="#03a852"> % allocate space for excitation signal</font>   
<br>for cel1 = 1:mgrid.num_x  <font color="#03a852"> % assign signals to source element</font>  
<br> &nbsp;&nbsp;for cel2 = 1:mgrid.num_y
<br>&nbsp;&nbsp;&nbsp;&nbsp;source_p(:, cel1, cel2) = sin(2*pi*fc*(ts+delay(cel1, cel2))).*exp(-(ts+delay(cel1, cel2)).^2*fc^2/2);
<br> &nbsp;&nbsp;end
<br> end
<br>RHO = sqrt(X.^2+Y.^2);
<br>source_p(:, RHO>TR_radius) = 0; <font color="#03a852"> %generate a circular transducer</font>  
</code>
 </p>

<!---Define the media--->
<h6>Define the media</h6>
<hr>
<p>
A nonlinear homogeneous medium with attenuation is defined.
 <code>
  <br>   
  <br>medium.c    = 1500;       <font color="#03a852">% speed of sound [m/s]</font>      
  <br>medium.rho  = 1000;       <font color="#03a852">% density [kg/m^3]</font>             
  <br>medium.beta = 3.6;          <font color="#03a852">% nonlinear coefficient </font>    
  <br>medium.ca   = 0.005;          <font color="#03a852">% attenuation coefficient [dB/(MHz^y cm)] </font>    
  <br>medium.cb   = 2.0;        <font color="#03a852">% power law exponent</font>    
 </code>
 </p>

<!--3D forward Simulation--->
<h6>3D forward simulation</h6>
<hr>
<p>
 Transient pressure field results are calculated with the 3D forward simulation function <a href="/mSOUND/functions">Forward3D</a>. 
 Pressure field generated with the phased array transducer is shown in the figure below. The 
 top two figures show the fundamental pressure field at the xz and xy plane. The bottom two figures show the second harmonic 
 pressure at the xz and xy plane.
<code>
  <br>
 <br>sensor_mask = zeros(mgrid.num_x, mgrid.num_y, mgrid.num_z); <font color="#03a852">% define where the pressure will be recorded</font>    
<br>sensor_mask(20:60, 20:60, :) = 1;
 <br> p_total = Forward3D(mgrid, medium, source_p, sensor_mask); 
  <br>
 </code>
 <br>
   <img src="/mSOUND/img/TMDM_3D_homogeneous.jpg" alt="Pressure field generated with the phased array">
 </p>




