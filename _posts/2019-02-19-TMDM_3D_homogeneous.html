---
title: Generation of the focused ultrasound beam in the 3D homogeneous medium with a phased-array using the transient mixed domain method
---
<hr>
<hr>
<p>
 This example shows how to simulate the wave propagation in the 3D 
 homogeneous medium with the transient mixed domain method and the focused beam is generated with the phased-array.
 
 </p>

 <br>
<!---define the structure grid--->
<h6>Generate the grid structure in the computational domain</h6>
<hr>
<p>
 <br>To define the temporal and spatial computational domain in 3D forward simulations, 
 the funciton <a href="/mSOUND/functions">set_grid</a> is used. For 3D problems,
 eight inputs are required to to call this function. Coordinates generated with the mgrid functiions are all in Cartesian coordinates.
 <br>
 <code>        
<br>dx = 3.75e-04;         <font color="#03a852"> %  step size in the x direction [m]</font> 
<br>dy = 3.75e-04;         <font color="#03a852"> %  step size in the y direction [m]</font> 
<br>dz = 3.75e-04;         <font color="#03a852"> %  step size in the z direction [m]</font> 
<br>dt = 6.25e-08;         <font color="#03a852"> %  time step size [s]</font> 

<br>x_length = 0.0450;         <font color="#03a852"> % total computatoinal domain size in x direction [m]</font> 
<br>y_length = 0.0450;         <font color="#03a852"> % total computatoinal domain size in y direction [m]</font> 
<br>z_length = 0.0210;         <font color="#03a852"> % total computatoinal domain size in z direction [m]</font> 
<br>t_length = 2.00e-05;       <font color="#03a852"> % total temporal domain size [s]</font> 
<br>mgrid = set_grid(dt, t_length, dx, x_length, dy, y_length, dz, z_length);              
</code>   
 <br>
</p>


<!---define the 3D phased array transducer--->
<h6>Define the 3D phased array transducer</h6>
<hr>
<p>
 In this example, phased array transducer is used to generate the foucsed ultrasound beam. 
<code>
<br>
<br>TR_focus  = 0.0150;      <font color="#03a852"> % transducer focus length [m]</font>         
<br>TR_radius = 0.0075;      <font color="#03a852"> % Transducer diameter [m]</font>  
<br>X = ones(mgrid.numy,1)*mgrid.x;
<br>Y = (ones(mgrid.numx,1)*mgrid.y).';
<br>delay = sqrt(X.^2 + Y.^2 + TR_focus^2)/medium.c0; <font color="#03a852"> % calculate the delay for each element [m]</font>   
<br>delay = delay - min(min(delay));
<br> 
</code>
</p>


<!---Excitation signal--->
<h6>Excitation signal</h6>
<hr>
<p>
A four-cycles gaussian-modulated pulse is used for the excitation signal.     
<code>
 <br>
<br>ts = [-num_cycles/fc:dt:num_cycles/fc].';<font color="#03a852"> % define the pulse length [s]</font>    
<br>ts = repmat(ts, 1,mgrid.num_x);  
 <br>source_p = zeros(length(ts), mgrid.num_x, mgrid.num_y); %allocate space for excitation signal
<br>for cel1 = 1:mgrid.num_x
<br> &nbsp;&nbsp;for cel2 = 1:mgrid.num_y
<br>&nbsp;&nbsp;&nbsp;&nbsp;source_p(:, cel1, cel2) = sin(2*pi*fc*(ts)).*exp(-(ts).^2*fc^2/2);
<br> &nbsp;&nbsp;end
<br> end
<br>RHO = sqrt(X.^2+Y.^2);
<br>source_p(:, RHO>TR_radius) = 0; 
</code>
 </p>

<!---Define the medium--->
<h6>Define the medium</h6>
<hr>
<p>
Define the homogeneous medium.
 <code>
  <br>   
  <br>medium.c    = 1500;       <font color="#03a852">% speed of sound [m/s]</font>      
  <br>medium.rho  = 1000;       <font color="#03a852">% density [kg/m^3]</font>             
  <br>medium.beta = 0;          <font color="#03a852">% nonlinear coefficient </font>    
  <br>medium.ca   = 0;          <font color="#03a852">% attenuation coefficient [dB/(MHz^y cm)] </font>    
  <br>medium.cb   = 2.0;        <font color="#03a852">% power law exponent</font>    
 </code>
 </p>

<!--3D forward Simulation--->
<h6>3D forward simulation</h6>
<hr>
<p>
 Transient pressure field results are calculated with the 3D forward simulation function <a href="/mSOUND/functions">Forward3D</a>. 
 Pressure field generated with the phased array transducer is shown in the figure below.
<code>
  <br>
<br> p_total = Forward3D(mgrid, medium, source_p); 
  <br>
 </code>
 <br>
   <img src="/mSOUND/img/phased_array_3D.jpg" alt="Pressure field generated with the phased array">
 </p>




