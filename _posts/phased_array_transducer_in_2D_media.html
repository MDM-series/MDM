---
title: Generate the focused ultrasound beam with a phased array
---
<hr>
<hr>
<br>
<!---define the structure grid--->
<h6>Generate the grid structure in the computational domain</h6>
<hr>
<p>
 <br>To define the temporal and spatial computational domain in 2D forward simulations, 
 we start from the funciton <a href="/mSOUND/functions">mgrid</a>. For 2D problems,
 six inputs are required to to call this function. Coordinates defined with the mgrid functiions are all in Cartesian coordinates.
 <br>
 <code>        
<br>dx = 3.75e-04;         <font color="#a5bad3"> %  step size in the x direction [m]</font> 
<br>dy = 3.75e-04;         <font color="#a5bad3"> %  step size in the y direction [m]</font> 
<br>dt = 6.25e-08;         <font color="#a5bad3"> %  time step size [s]</font> 

<br>xlen = 0.0735;         <font color="#a5bad3"> % total computatoinal domain size in x direction [m]</font> 
<br>ylen = 0.0210;         <font color="#a5bad3"> % total computatoinal domain size in y direction [m]</font> 
<br>tlen = 4.40e-05;       <font color="#a5bad3"> % total temporal domain size [s]</font> 
<br>mgrid = set_grid(dt, tlen, dx, xlen, dy, ylen);              
</code>   
 <br>
</p>


<!---define the phased array transducer--->
<h6>Define the phased array transducer</h6>
<hr>
<p>
 In this example, phased array transducer is used to generate the foucsed ultrasound beam. 
<code>
<br>
<br>TR_focus  = 0.0210;      <font color="#a5bad3"> % transducer focus length [m]</font>         
<br>TR_radius = 0.0135;      <font color="#a5bad3"> % Transducer diameter [m]</font>   
<br>num_el = round(TR_radius*2/mgrid.dx);   <font color="#a5bad3">% [grid points]</font>   
<br>el_x  = -floor(num_el/2):floor(num_el/2);    
<br>  <font color="#a5bad3">% calculate the time delay for each transducer element[s]</font>   
<br>delay = sqrt((el_x*mgrid.dx).^2 + (TR_focus)^2)/medium.c0;   
<br> delay = delay - min(delay);
<br> 
</code>
 </p>

<!---Excitation signal--->
<h6>Excitation signal</h6>
<hr>
<p>
<br> A 4-cycles gaussian-modulated pulse is used for the excitation signal.            
<code>
<br>ts = [-num_cycles/fc:dt:num_cycles/fc].';<font color="#a5bad3"> % define the pulse length [s]</font>           
<br>delay = repmat(delay, length(ts),1);   
<br>ts = repmat(ts, 1,length(el_x));       
<br>excit_ps = p0*sin(2*pi*fc*(ts+delay)).*exp(-(ts+delay).^2*fc^2/2); <font color="#a5bad3"> % define the pulse </font>   
<br>
</code>
 </p>

<!---Define the medium--->
<h6>Define the medium</h6>
<p>
 Transient pressure field results are calculated with the 2D forward simulation function <a href="/mSOUND/functions">Forward2D</a>.
 <code>
  <br>   
  <br>medium.c    = 1500;       <font color="#a5bad3">% speed of sound [m/s]</font>      
  <br>medium.rho  = 1000;       <font color="#a5bad3">% density [kg/m^3]</font>             
  <br>medium.beta = 0;          <font color="#a5bad3">% nonlinear coefficient </font>    
  <br>medium.ca   = 0;          <font color="#a5bad3">% attenuation coefficient [dB/(MHz^y cm)] </font>    
  <br>medium.cb   = 2.0;        <font color="#a5bad3">% power law exponent</font>    
 </code>
 </p>

<!---2D forward Simulation--->
<h6>2D forward simulation</h6>
<p>
 Transient pressure field results are calculated with the 2D forward simulation function <a href="/mSOUND/functions">Forward2D</a>.
<code>
  <br>
<br> p_total = Forward2D(mgrid, medium, excit_p); 
  <br>
 </code>
 </p>

 
 
