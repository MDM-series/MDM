---
title: Simulation of a 3D heterogeneous medium using the frequency-specific mixed domain method
---
<p>
<br>
<hr>
<hr>
This example shows how to simulate the wave propagation in 3D heterogeneous media with the frequency-specific mixed domain method. 
A skull-like medium and a focused beam are assumed in this example. 
<hr>
<hr>
</p>

<!---define the structure grid--->
<h6>Defining the medium properties</h6>
<hr>
<p>
 <br>Details of defining the computational domain and the phased-array transducer are shown in the example 
 <a href="https://m-sound.github.io/mSOUND/FSMDM_3D_homogeneous">
 Simulation of a 3D homogeneous medium using the frequency-specific mixed domain method</a>. 
 A 2D view in the xz plane of the 3D model used in this simulation is illustrated in the figure below.
   <pre>
 <code>
load 3D_heterogeneous_model.mat; 
medium.c    = c;      <font color="#03a852">% speed of sound [m/s]</font>      
medium.rho  = rho;    <font color="#03a852">% density [kg/m^3]</font>             
medium.beta = beta;   <font color="#03a852">% nonlinearity coefficient </font>    
medium.ca   = ca;     <font color="#03a852">% attenuation coefficient [dB/(MHz^y cm)] </font>    
medium.cb   = cb;     <font color="#03a852">% power law exponent</font>   
medium.NRL_gamma = 0.5;
medium.NRL_alpha = 0.1;
</code>
</pre>
<img src="/mSOUND/img/3D_heterogeneous_model.jpg" alt="3D model">
</p>


<!---3D forward simulation--->
<h6>3D forward simulation</h6>
<hr>
<p>
 <br>
 The fundamental frequency pressure field is first calculated with the 3D forward simulation function
 <a href="/mSOUND/function.html#Forward3D_fund">Forward3D_fund</a>. 
 Correction is applied in this example because the speed of sound and density contrast in this case are both 1.5. 
<pre> <code>
reflection_order = 4;
<font color="#03a852">% forward propagation of the fundamental pressure</font>   
p_fundamental = Forward3D_fund(mgrid, medium, source_p, omega_c,...
                reflection_order, 'correction', 'NRL'); 
</code> </pre>
                     
</p>
<p>
The figure below shows the pressure fields in the (a) xz plane, (b) yz plane and (c) xy plane simulated with mSOUND. 
<img src="/mSOUND/img/FSMDM_3D_heterogeneous.jpg" alt="fundamental and the fundamental pressure field">
</p>
                                                                                                        

<p>
The figure below shows pressure field in the (a) xz plane, (b) yz plane and (c) xy plane simulated with k-Wave.                                                                                                            
<img src="/mSOUND/img/KWAVE_3D_heterogeneous.jpg" alt="fundamental and the second-harmonic pressure field">
</p>
                                                                                                               


<h6>Other examples</h6>
<hr>
<p>
<br> <h7 style='font-weight:bold;'>&#11166;Forward TMDM</h7>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/TMDM_2D_homogeneous">
    Simulation of a 2D homogeneous medium using the transient mixed domain method</a>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/TMDM_2D_heterogeneous">
    Simulation of a 2D heterogeneous medium using the transient mixed domain method</a>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/TMDM-2D-strong-speed-of-sound-contrast">
    Simulation of a strongly 2D heterogeneous medium using the transient mixed domain method</a>  
<br>&middot;<a href="https://m-sound.github.io/mSOUND/TMDM_3D_homogeneous">
    Simulation of a 3D homogeneous medium using the transient mixed domain method</a>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/TMDM_2D_animation">
    Efficient simulation with TMDM</a>   
 
<br><h7 style='font-weight:bold;'>&#11166;Forward FSMDM</h7>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/FSMDM_2D_homogeneous">
    Simulation of a 2D homogeneous medium using the frequency-specific mixed domain method</a>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/FSMDM_2D_heterogeneous">
    Simulation of a 2D heterogeneous medium using the frequency-specific mixed domain method</a>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/FSMDM_3D_homogeneous">
    Simulation of a 3D homogeneous medium using the frequency-specific mixed domain method</a>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/FSMDM-3D_heterogeneous">
    Simulation of a 3D heterogeneous medium using the frequency-specific mixed domain method</a>
 <br>&middot;<a href="https://m-sound.github.io/mSOUND/2D_absorption">
    Reducing the spatial aliasing error using the non-reflecting layer</a>

 <br><h7 style='font-weight:bold;'>&#11166;Backward Propagation</h7>
 <br>&middot;<a href="https://m-sound.github.io/mSOUND/Backward_TMDM">
    Image reconstruction using backward projection</a>    
 <br>&middot;<a href="https://m-sound.github.io/mSOUND/FSMDM_3D_multi_sources">
    Reconstruction of the source distribution with FSMDM in a 3D homogeneous medium</a>
 
 <br><h7 style='font-weight:bold;'>&#11166;Integration with Other Simulators</h7>
 <br>&middot;<a href="https://m-sound.github.io/mSOUND/combine-k-Wave-TMDM">
    Integrating mSOUND with k-Wave for transducers of arbitrary shape</a>
 <br>&middot;<a href="https://m-sound.github.io/mSOUND/combine-k-Wave-diffusion">
    Integrating mSOUND with k-Wave for thermal simulations</a> 
</p>
